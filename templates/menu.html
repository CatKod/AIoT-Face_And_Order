{% extends "base.html" %}

{% block title %}Menu Management - Caf√© Face Recognition System{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="fas fa-utensils"></i> Menu Management</h1>
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addItemModal">
        <i class="fas fa-plus"></i> Add Menu Item
    </button>
</div>

<!-- Menu Categories -->
<div class="row mb-4">
    <div class="col-12">
        <div class="btn-group" role="group">
            <button type="button" class="btn btn-outline-primary active" onclick="filterMenu('all')">All Items</button>
            <button type="button" class="btn btn-outline-success" onclick="filterMenu('food')">Food</button>
            <button type="button" class="btn btn-outline-info" onclick="filterMenu('drink')">Drinks</button>
        </div>
    </div>
</div>

<!-- Food Items -->
{% if food_items %}
<div class="food-section menu-section">
    <h3><i class="fas fa-hamburger"></i> Food Items</h3>
    <div class="row">
        {% for item in food_items %}
        <div class="col-md-6 col-lg-4 mb-4 menu-item" data-category="food">
            <div class="card h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <h5 class="card-title">{{ item.name }}</h5>
                        <div class="dropdown">
                            <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="dropdown">
                                <i class="fas fa-ellipsis-v"></i>
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#" onclick="editItem({{ item.id }})"><i class="fas fa-edit"></i> Edit</a></li>
                                <li><a class="dropdown-item" href="#" onclick="toggleAvailability({{ item.id }})">
                                    <i class="fas fa-{% if item.is_available %}eye-slash{% else %}eye{% endif %}"></i> 
                                    {% if item.is_available %}Disable{% else %}Enable{% endif %}
                                </a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item text-danger" href="#" onclick="deleteItem({{ item.id }})"><i class="fas fa-trash"></i> Delete</a></li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="mb-2">
                        <span class="badge bg-success">{{ item.category }}</span>
                        {% if item.subcategory %}
                            <span class="badge bg-light text-dark">{{ item.subcategory }}</span>
                        {% endif %}
                        {% if not item.is_available %}
                            <span class="badge bg-danger">Unavailable</span>
                        {% endif %}
                    </div>
                    
                    {% if item.description %}
                    <p class="card-text">{{ item.description }}</p>
                    {% endif %}
                    
                    <div class="row text-center mb-3">
                        <div class="col-6">
                            <h4 class="text-success mb-0">${{ "%.2f" % item.price }}</h4>
                            <small class="text-muted">Price</small>
                        </div>
                        <div class="col-6">
                            <h4 class="text-info mb-0">{{ item.calories or 'N/A' }}</h4>
                            <small class="text-muted">Calories</small>
                        </div>
                    </div>
                    
                    {% if item.ingredients %}
                    <div class="mb-2">
                        <small class="text-muted"><strong>Ingredients:</strong></small>
                        <div>
                            {% for ingredient in item.ingredients %}
                            <span class="badge bg-light text-dark me-1">{{ ingredient }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if item.allergens %}
                    <div class="mb-2">
                        <small class="text-warning"><strong>Allergens:</strong></small>
                        <div>
                            {% for allergen in item.allergens %}
                            <span class="badge bg-warning text-dark me-1">{{ allergen }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- Drink Items -->
{% if drink_items %}
<div class="drink-section menu-section mt-5">
    <h3><i class="fas fa-coffee"></i> Drink Items</h3>
    <div class="row">
        {% for item in drink_items %}
        <div class="col-md-6 col-lg-4 mb-4 menu-item" data-category="drink">
            <div class="card h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <h5 class="card-title">{{ item.name }}</h5>
                        <div class="dropdown">
                            <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="dropdown">
                                <i class="fas fa-ellipsis-v"></i>
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#" onclick="editItem({{ item.id }})"><i class="fas fa-edit"></i> Edit</a></li>
                                <li><a class="dropdown-item" href="#" onclick="toggleAvailability({{ item.id }})">
                                    <i class="fas fa-{% if item.is_available %}eye-slash{% else %}eye{% endif %}"></i> 
                                    {% if item.is_available %}Disable{% else %}Enable{% endif %}
                                </a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item text-danger" href="#" onclick="deleteItem({{ item.id }})"><i class="fas fa-trash"></i> Delete</a></li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="mb-2">
                        <span class="badge bg-info">{{ item.category }}</span>
                        {% if item.subcategory %}
                            <span class="badge bg-light text-dark">{{ item.subcategory }}</span>
                        {% endif %}
                        {% if not item.is_available %}
                            <span class="badge bg-danger">Unavailable</span>
                        {% endif %}
                    </div>
                    
                    {% if item.description %}
                    <p class="card-text">{{ item.description }}</p>
                    {% endif %}
                    
                    <div class="row text-center mb-3">
                        <div class="col-6">
                            <h4 class="text-success mb-0">${{ "%.2f"|format(item.price) }}</h4>
                            <small class="text-muted">Price</small>
                        </div>
                        <div class="col-6">
                            <h4 class="text-info mb-0">{{ item.calories or 'N/A' }}</h4>
                            <small class="text-muted">Calories</small>
                        </div>
                    </div>
                    
                    {% if item.ingredients %}
                    <div class="mb-2">
                        <small class="text-muted"><strong>Ingredients:</strong></small>
                        <div>
                            {% for ingredient in item.ingredients %}
                            <span class="badge bg-light text-dark me-1">{{ ingredient }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if item.allergens %}
                    <div class="mb-2">
                        <small class="text-warning"><strong>Allergens:</strong></small>
                        <div>
                            {% for allergen in item.allergens %}
                            <span class="badge bg-warning text-dark me-1">{{ allergen }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- Empty State -->
{% if not food_items and not drink_items %}
<div class="text-center">
    <div class="card">
        <div class="card-body py-5">
            <i class="fas fa-utensils fa-5x text-muted mb-4"></i>
            <h3>No menu items yet</h3>
            <p class="text-muted">Start building your menu by adding food and drink items.</p>
            <button class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#addItemModal">
                <i class="fas fa-plus"></i> Add First Menu Item
            </button>
        </div>
    </div>
</div>
{% endif %}

<!-- Add Item Modal -->
<div class="modal fade" id="addItemModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-plus"></i> Add Menu Item</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="POST" action="{{ url_for('add_menu_item') }}">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="name" class="form-label">Item Name *</label>
                                <input type="text" class="form-control" id="name" name="name" required>
                            </div>
                            
                            <div class="mb-3">
                                <label for="category" class="form-label">Category *</label>
                                <select class="form-select" id="category" name="category" required onchange="updateSubcategories()">
                                    <option value="">Choose...</option>
                                    <option value="food">Food</option>
                                    <option value="drink">Drink</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label for="subcategory" class="form-label">Subcategory</label>
                                <select class="form-select" id="subcategory" name="subcategory">
                                    <option value="">Choose category first...</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label for="price" class="form-label">Price ($) *</label>
                                <input type="number" class="form-control" id="price" name="price" step="0.01" min="0" required>
                            </div>
                            
                            <div class="mb-3">
                                <label for="calories" class="form-label">Calories</label>
                                <input type="number" class="form-control" id="calories" name="calories" min="0">
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="description" class="form-label">Description</label>
                                <textarea class="form-control" id="description" name="description" rows="3"></textarea>
                            </div>
                            
                            <div class="mb-3">
                                <label for="ingredients" class="form-label">Ingredients</label>
                                <input type="text" class="form-control" id="ingredients" name="ingredients" 
                                       placeholder="Comma-separated (e.g., flour, sugar, eggs)">
                                <div class="form-text">Separate ingredients with commas</div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="allergens" class="form-label">Allergens</label>
                                <input type="text" class="form-control" id="allergens" name="allergens" 
                                       placeholder="Comma-separated (e.g., gluten, dairy, nuts)">
                                <div class="form-text">Separate allergens with commas</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Item</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Menu Statistics -->
{% if food_items or drink_items %}
<div class="row mt-5">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-chart-bar"></i> Menu Statistics</h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-md-3">
                        <h4 class="text-primary">{{ (food_items|length) + (drink_items|length) }}</h4>
                        <small class="text-muted">Total Items</small>
                    </div>
                    <div class="col-md-3">
                        <h4 class="text-success">{{ food_items|length }}</h4>
                        <small class="text-muted">Food Items</small>
                    </div>
                    <div class="col-md-3">
                        <h4 class="text-info">{{ drink_items|length }}</h4>
                        <small class="text-muted">Drink Items</small>
                    </div>
                    <div class="col-md-3">
                        {% set all_items = food_items + drink_items %}
                        {% set total_items = all_items|length %}
                        {% if total_items > 0 %}
                            {% set total_price = 0 %}
                            {% for item in all_items %}
                                {% set total_price = total_price + (item.price|float) %}
                            {% endfor %}
                            <h4 class="text-warning">${{ "%.2f"|format(total_price / total_items) }}</h4>
                        {% else %}
                            <h4 class="text-warning">$0.00</h4>
                        {% endif %}
                        <small class="text-muted">Average Price</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
const subcategoryOptions = {
    food: ['pastry', 'sandwich', 'salad', 'main course', 'appetizer', 'dessert', 'snack'],
    drink: ['coffee', 'tea', 'juice', 'smoothie', 'soda', 'water', 'alcoholic', 'specialty']
};

function updateSubcategories() {
    const category = document.getElementById('category').value;
    const subcategorySelect = document.getElementById('subcategory');
    
    // Clear existing options
    subcategorySelect.innerHTML = '<option value="">Choose...</option>';
    
    if (category && subcategoryOptions[category]) {
        subcategoryOptions[category].forEach(subcat => {
            const option = document.createElement('option');
            option.value = subcat;
            option.textContent = subcat.charAt(0).toUpperCase() + subcat.slice(1);
            subcategorySelect.appendChild(option);
        });
    }
}

function filterMenu(category) {
    const menuItems = document.querySelectorAll('.menu-item');
    const menuSections = document.querySelectorAll('.menu-section');
    const buttons = document.querySelectorAll('.btn-group .btn');
    
    // Update button states
    buttons.forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    
    if (category === 'all') {
        menuItems.forEach(item => item.style.display = 'block');
        menuSections.forEach(section => section.style.display = 'block');
    } else {
        menuItems.forEach(item => {
            if (item.dataset.category === category) {
                item.style.display = 'block';
            } else {
                item.style.display = 'none';
            }
        });
        
        menuSections.forEach(section => {
            if (section.classList.contains(`${category}-section`)) {
                section.style.display = 'block';
            } else {
                section.style.display = 'none';
            }
        });
    }
}

function editItem(itemId) {
    // In a real implementation, this would open an edit modal with the item's current data
    alert(`Edit functionality for item ${itemId} would be implemented here`);
}

function toggleAvailability(itemId) {
    if (confirm('Toggle availability for this item?')) {
        // In a real implementation, this would make an API call to toggle availability
        alert(`Toggle availability for item ${itemId} would be implemented here`);
        location.reload();
    }
}

function deleteItem(itemId) {
    if (confirm('Are you sure you want to delete this menu item? This action cannot be undone.')) {
        // In a real implementation, this would make an API call to delete the item
        alert(`Delete functionality for item ${itemId} would be implemented here`);
        location.reload();
    }
}

// Add some interactive features
document.addEventListener('DOMContentLoaded', function() {
    // Add hover effects to cards
    const cards = document.querySelectorAll('.menu-item .card');
    cards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-2px)';
            this.style.boxShadow = '0 4px 8px rgba(0,0,0,0.1)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = '';
        });
    });
});
</script>

<style>
.menu-item .card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.menu-section {
    transition: opacity 0.3s ease;
}

.badge {
    font-size: 0.75em;
}

.dropdown-menu {
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.btn-group .btn.active {
    background-color: #007bff;
    border-color: #007bff;
    color: white;
}

@media (max-width: 768px) {
    .col-md-6.col-lg-4 {
        margin-bottom: 1rem;
    }
    
    .modal-dialog {
        margin: 1rem;
    }
}
</style>
{% endblock %}
